<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recharge - Coris Max</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://bkapay.com/bkapay-inline.js"></script>

<style>
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#f4f7ff;
}

/* HEADER */
.header{
    background:linear-gradient(135deg,#3a5cb8,#2ea78d);
    padding:30px 20px 60px;
    color:white;
    border-radius:0 0 40px 40px;
    text-align:center;
}

.header h2{
    font-size:20px;
    font-weight:600;
}

.container{
    padding:20px;
    max-width:450px;
    margin:auto;
}

.card{
    background:white;
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.05);
}

.card h3{
    text-align:center;
    margin-bottom:20px;
}

/* Montants rapides */
.quick-amounts{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    margin:15px 0;
}

.quick-amounts button{
    border:1px solid #ccc;
    border-radius:50%;
    padding:12px;
    background:white;
    cursor:pointer;
    font-weight:500;
    color:#555;
    transition: all 0.2s ease;
}

.quick-amounts button.selected, .quick-amounts button:hover{
    border-color:#3a5cb8;
    color:#3a5cb8;
}

/* Canal dÃ©pÃ´t - style radio */
.country-option{
    display:flex;
    align-items:center;
    justify-content:space-between;
    border:1px solid #ddd;
    border-radius:10px;
    padding:12px;
    margin-top:10px;
    cursor:pointer;
    transition: all 0.2s ease;
}

.country-option input[type="radio"]{
    accent-color:#3a5cb8;
}

.country-option:hover{
    border-color:#3a5cb8;
}

/* Infos utilisateur et opÃ©rateur en bas */
.user-info input, .user-info select{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:1px solid #ddd;
}

/* Bouton principal */
button#deposit-btn{
    width:100%;
    margin-top:20px;
    padding:14px;
    border:none;
    border-radius:30px;
    background:linear-gradient(to right,#3a5cb8,#2ea78d);
    color:white;
    font-weight:600;
    cursor:pointer;
    font-size:16px;
}
</style>
</head>

<body>

<div class="header">
    <h2>ðŸ’° DÃ©poser de l'argent</h2>
</div>

<div class="container">
    <div class="card">
        <h3>Recharger votre compte</h3>

        <!-- Montants rapides -->
        <div class="quick-amounts">
            <button type="button" onclick="setQuickAmount(2000)">2000</button>
            <button type="button" onclick="setQuickAmount(5000)">5000</button>
            <button type="button" onclick="setQuickAmount(7000)">7000</button>
            <button type="button" onclick="setQuickAmount(10000)">10000</button>
            <button type="button" onclick="setQuickAmount(20000)">20000</button>
            <button type="button" onclick="setQuickAmount(50000)">50000</button>
            <button type="button" onclick="setQuickAmount(100000)">100000</button>
            <button type="button" onclick="setQuickAmount(200000)">200000</button>
        </div>

        <!-- Canal dÃ©pÃ´t -->
        <div>
            <label>Choisissez votre pays</label>
            <div class="country-option">
                <span>ðŸ‡¹ðŸ‡¬ Togo</span>
                <input type="radio" name="country" value="Togo">
            </div>
            <div class="country-option">
                <span>ðŸ‡§ðŸ‡¯ BÃ©nin</span>
                <input type="radio" name="country" value="BÃ©nin">
            </div>
            <div class="country-option">
                <span>ðŸ‡¨ðŸ‡® CÃ´te d'Ivoire</span>
                <input type="radio" name="country" value="CÃ´te d'Ivoire">
            </div>
            <div class="country-option">
                <span>ðŸ‡¨ðŸ‡² Cameroun</span>
                <input type="radio" name="country" value="Cameroun">
            </div>
            <div class="country-option">
                <span>ðŸ‡§ðŸ‡« Burkina Faso</span>
                <input type="radio" name="country" value="Burkina Faso">
            </div>
        </div>

        <!-- Informations utilisateur et opÃ©rateur -->
        <div class="user-info">
            <input type="text" id="fullname" placeholder="Nom complet" required>
            <input type="email" id="email" placeholder="Email" required>
            <input type="text" id="phone" placeholder="NumÃ©ro tÃ©lÃ©phone (ex: 22961000000)" required>

            <select id="operator" required>
                <option value="">Choisissez l'opÃ©rateur</option>
                <option value="Moov Togo">Moov Togo</option>
                <option value="Tmoney Togo">Tmoney Togo</option>
                <option value="Moov BÃ©nin">Moov BÃ©nin</option>
                <option value="MTN">MTN</option>
                <option value="Momo">Momo</option>
                <option value="Orange Money">Orange Money</option>
            </select>

            <input type="number" id="montant" placeholder="Montant minimum 3000" required>
        </div>

        <!-- Bouton dÃ©pÃ´t -->
        <button id="deposit-btn" onclick="initDeposit()">DÃ©poser maintenant</button>
    </div>
</div>

<script>
/* Gestion des montants rapides */
function setQuickAmount(value){
    document.getElementById("montant").value = value;

    document.querySelectorAll(".quick-amounts button").forEach(btn=>{
        btn.classList.remove("selected");
    });
    event.target.classList.add("selected");
}

/* Logique de dÃ©pÃ´t */
function initDeposit(){
    const fullname = document.getElementById("fullname").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const montant = parseInt(document.getElementById("montant").value);

    const countryRadio = document.querySelector('input[name="country"]:checked');
    const country = countryRadio ? countryRadio.value : null;

    const operator = document.getElementById("operator").value;

    if(!fullname || !email || !phone || !country || !operator){
        alert("Veuillez remplir tous les champs");
        return;
    }

    if(montant < 3000){
        alert("Montant minimum 3000 FCFA");
        return;
    }

    fetch("/create-deposit",{
        method:"POST",
        headers:{ "Content-Type":"application/x-www-form-urlencoded" },
        body:`fullname=${encodeURIComponent(fullname)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}&country=${encodeURIComponent(country)}&operator=${encodeURIComponent(operator)}&montant=${montant}`
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            BKApay.checkout({
                key: "pk_live_a7a729fb-30b9-411f-b07f-218e698f1876",
                amount: data.amount,
                description: "Recharge compte Coris Max",
                orderId: "DEPOT-"+data.depot_id,
                customer: { name: fullname, email: email, phone: phone },
                onSuccess: function(response){
                    fetch("/verify-payment",{
                        method:"POST",
                        headers:{ "Content-Type":"application/json" },
                        body: JSON.stringify({ transactionId: response.transactionId, depot_id: data.depot_id })
                    })
                    .then(res=>res.json())
                    .then(result=>{
                        if(result.success){
                            alert("Paiement confirmÃ© ðŸŽ‰");
                            window.location.href="/dashboard";
                        }else{
                            alert("Erreur de vÃ©rification");
                        }
                    });
                },
                onError: function(error){
                    alert("Paiement Ã©chouÃ©: "+error.message);
                },
                onClose: function(){
                    console.log("Paiement annulÃ©");
                }
            });
        }else{
            alert(data.error);
        }
    })
    .catch(err=>{
        console.error(err);
        alert("Erreur lors de la crÃ©ation du dÃ©pÃ´t");
    });
}
</script>

</body>
</html>
